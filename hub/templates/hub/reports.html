{% extends "hub/base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>Reports & Insights</h2>
  <small class="text-muted">Data updates as contributions are approved</small>
</div>

<div class="row g-3 mb-4">
  <div class="col-md-4"><div class="card shadow-sm"><div class="card-body"><p class="text-muted mb-1">Total Approved Hours</p><h3 class="mb-0">{{ total_hours|default:"0" }}</h3></div></div></div>
  <div class="col-md-4"><div class="card shadow-sm"><div class="card-body"><p class="text-muted mb-1">Pending Contributions</p><h3 class="mb-0">{{ pending_total }}</h3></div></div></div>
  <div class="col-md-4"><div class="card shadow-sm"><div class="card-body"><p class="text-muted mb-1">Total Contributions</p><h3 class="mb-0">{{ total_contributions }}</h3></div></div></div>
</div>

<div class="row g-4">
  <div class="col-md-6">
    <div class="card p-3 shadow-sm">
      <h5 class="card-title mb-2">Top 10 Volunteers</h5>
      {% if has_rank_data %}<canvas id="rankChart" height="220"></canvas>{% else %}<p class="text-muted mb-0">No approved contributions yet.</p>{% endif %}
    </div>
  </div>
  <div class="col-md-6">
    <div class="card p-3 shadow-sm">
      <h5 class="card-title mb-2">Hours by Department</h5>
      {% if has_dept_data %}<canvas id="deptChart" height="220"></canvas>{% else %}<p class="text-muted mb-0">No department data available.</p>{% endif %}
    </div>
  </div>
  <div class="col-12">
    <div class="card p-3 shadow-sm">
      <h5 class="card-title mb-2">Average Hours per Contribution by Department</h5>
      {% if has_avg_data %}<canvas id="avgChart" height="260"></canvas>{% else %}<p class="text-muted mb-0">Average breakdown available after approvals.</p>{% endif %}
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  if (typeof Chart === "undefined") return;
  const colors = ["#0d6efd","#6610f2","#6f42c1","#d63384","#fd7e14","#f03","#20c997","#198754","#0dcaf0","#ffc107"];
  {% if has_rank_data %}
  new Chart(document.getElementById("rankChart"), {
    type: "bar",
    data: { labels: {{ rank_labels_json|safe }}, datasets: [{ label: "Hours", data: {{ rank_data_json|safe }}, backgroundColor: colors }] },
    options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
  });
  {% endif %}
  {% if has_dept_data %}
  new Chart(document.getElementById("deptChart"), {
    type: "pie",
    data: { labels: {{ dept_labels_json|safe }}, datasets: [{ data: {{ dept_data_json|safe }}, backgroundColor: colors }] },
    options: { responsive: true }
  });
  {% endif %}
  {% if has_avg_data %}
  new Chart(document.getElementById("avgChart"), {
    type: "line",
    data: { labels: {{ avg_labels_json|safe }}, datasets: [{ label: "Avg Hours", data: {{ avg_data_json|safe }}, borderColor: "#0d6efd", backgroundColor: "rgba(13,110,253,0.2)", fill: true, tension: 0.4 }] },
    options: { responsive: true, scales: { y: { beginAtZero: true } } }
  });
  {% endif %}
});
</script>
{% endblock %}
