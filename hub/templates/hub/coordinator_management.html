{% extends "hub/base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>Coordinator Management</h2>
</div>

<div class="card mb-4">
  <div class="card-body">
    <form method="get" class="row g-3 align-items-end">
      <div class="col-md-4">
        <label class="form-label">Search</label>
        <input type="text" name="search" class="form-control" placeholder="Search by username, name, email..." value="{{ search }}">
      </div>
      <div class="col-md-3">
        <label class="form-label">Filter by Department</label>
        <select name="department" class="form-select">
          <option value="">All Departments</option>
          {% for dept in departments %}
          <option value="{{ dept.pk }}" {% if dept_filter == dept.pk|stringformat:"s" %}selected{% endif %}>
            {{ dept.name }}
          </option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100">Filter</button>
      </div>
      <div class="col-md-2">
        <a href="{% url 'hub:coordinator_management' %}" class="btn btn-outline-secondary w-100">Reset</a>
      </div>
    </form>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Username</th>
            <th>Name</th>
            <th>Email</th>
            <th>Department</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
          <tr>
            <td>{{ user.username }}</td>
            <td>{{ user.get_full_name|default:"—" }}</td>
            <td>{{ user.email|default:"—" }}</td>
            <td>{{ user.profile.department|default:"—" }}</td>
            <td>
              {% if user.profile.is_coordinator %}
                <span class="badge bg-success">Coordinator</span>
              {% else %}
                <span class="badge bg-secondary">Volunteer</span>
              {% endif %}
            </td>
            <td>
              {% if user.profile.is_coordinator %}
                {% if user == request.user %}
                  <span class="text-muted">(You)</span>
                {% else %}
                  <form method="post" style="display:inline;" onsubmit="return confirm('Remove coordinator status from {{ user.username }}?');">
                    {% csrf_token %}
                    <input type="hidden" name="user_id" value="{{ user.pk }}">
                    <input type="hidden" name="action" value="demote">
                    <button type="submit" class="btn btn-sm btn-warning">Remove Coordinator</button>
                  </form>
                {% endif %}
              {% else %}
                <form method="post" style="display:inline;">
                  {% csrf_token %}
                  <input type="hidden" name="user_id" value="{{ user.pk }}">
                  <input type="hidden" name="action" value="promote">
                  <button type="submit" class="btn btn-sm btn-success">Make Coordinator</button>
                </form>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted">No users found.{% if search or dept_filter %} Try adjusting your filters.{% endif %}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% if users.has_other_pages %}
  <nav aria-label="Users pagination" class="mt-4">
    <ul class="pagination justify-content-center">
      {% if users.has_previous %}
        <li class="page-item"><a class="page-link" href="?page=1{% if search %}&search={{ search }}{% endif %}{% if dept_filter %}&department={{ dept_filter }}{% endif %}">First</a></li>
        <li class="page-item"><a class="page-link" href="?page={{ users.previous_page_number }}{% if search %}&search={{ search }}{% endif %}{% if dept_filter %}&department={{ dept_filter }}{% endif %}">Previous</a></li>
      {% endif %}
      <li class="page-item active"><span class="page-link">Page {{ users.number }} of {{ users.paginator.num_pages }}</span></li>
      {% if users.has_next %}
        <li class="page-item"><a class="page-link" href="?page={{ users.next_page_number }}{% if search %}&search={{ search }}{% endif %}{% if dept_filter %}&department={{ dept_filter }}{% endif %}">Next</a></li>
        <li class="page-item"><a class="page-link" href="?page={{ users.paginator.num_pages }}{% if search %}&search={{ search }}{% endif %}{% if dept_filter %}&department={{ dept_filter }}{% endif %}">Last</a></li>
      {% endif %}
    </ul>
  </nav>
{% endif %}
{% endblock %}

